<project name="realtime-snap" app="Snap! 10.1-dev, https://snap.berkeley.edu" version="2"><notes></notes><thumbnail>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAB4CAYAAAB1ovlvAAAAAXNSR0IArs4c6QAAAtRJREFUeF7t1zFqomEYRtFPGyEgbiG7sUjaVDZJK6R1ATbZSJaQBWQzIU0EC1MGB6ZLYWaaeEGO9Y8P/30PiJPj8XgcPgpEBSYARuXN/i0AIAhpAQDT/MYBZCAtAGCa3ziADKQFAEzzGweQgbQAgGl+4wAykBYAMM1vHEAG0gIApvmNA8hAWgDANL9xABlICwCY5jcOIANpAQDT/MYBZCAtAGCa3ziADKQFAEzzGweQgbQAgGl+4wAykBYAMM1vHEAG0gIApvmNA8hAWgDANL9xABlICwCY5jcOIANpAQDT/MYBZCAtAGCa3ziADKQFAEzzGweQgbQAgGl+4wAykBYAMM1vHEAG0gIApvmNA8hAWgDANL9xABlICwCY5jcOIANpAQDT/MYBZCAtAGCa3ziADKQFAEzzGweQgbQAgCfyv7y8jLe3t7FcLsf19XV6pEseB/DEdff7/Xh8fByHw2F8fHyM29vbMZlMxmazuWQPZ383AH9I/vr6Orbb7VgsFt+emk6n4+7ubnx9fY3VanX2o13SIID/APj09DSurq6+PbXb7cZ6vR7z+Xzc3NxckoezvwuA//ET/P7+Pu7v78dsNhsPDw9nP9IlDwJ44rrPz8/j8/PTn5Bf1g/gLwf29T8XAJCQtACAaX7jADKQFgAwzW8cQAbSAgCm+Y0DyEBaAMA0v3EAGUgLAJjmNw4gA2kBANP8xgFkIC0AYJrfOIAMpAUATPMbB5CBtACAaX7jADKQFgAwzW8cQAbSAgCm+Y0DyEBaAMA0v3EAGUgLAJjmNw4gA2kBANP8xgFkIC0AYJrfOIAMpAUATPMbB5CBtACAaX7jADKQFgAwzW8cQAbSAgCm+Y0DyEBaAMA0v3EAGUgLAJjmNw4gA2kBANP8xgFkIC0AYJrfOIAMpAUATPMbB5CBtACAaX7jADKQFgAwzW8cQAbSAgCm+Y0DyEBaAMA0v/E/nncUtz6zf9UAAAAASUVORK5CYII=</thumbnail><scenes select="1"><scene name="realtime-snap"><notes></notes><hidden></hidden><headers></headers><code></code><blocks><block-definition s="openai Realtime(WebRTC) API for speech $nl token %&apos;token&apos;" type="command" category="operators"><header></header><code></code><translations></translations><inputs><input type="%s" initial="1"></input></inputs><script><custom-block s="_初始化"></custom-block><block s="doRun"><block s="reportJSFunction"><list><l>token</l></list><l>if (!window.session){&#xD;  window.session = new window.ChatSession(token);&#xD;  // session.pauseSession();&#xD;  // session.endSession();&#xD;}</l></block><list><block var="token"/></list></block></script></block-definition><block-definition s="_初始化" type="command" category="operators"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list></list><l>class ChatSession {&#xD;  constructor(token) {&#xD;    this.token = token;&#xD;    this.pc = null;&#xD;    this.audioEl = document.createElement("audio");&#xD;    this.audioEl.autoplay = true;&#xD;    this.dc = null;&#xD;    this.ms = null;&#xD;    this.baseUrl = "https://api.openai.com/v1/realtime";&#xD;    this.model = "gpt-4o-realtime-preview-2024-12-17";&#xD;  }&#xD;&#xD;  async startSession() {&#xD;    if (this.pc) {&#xD;      console.log("Session is already running.");&#xD;      return;&#xD;    }&#xD;&#xD;    this.pc = new RTCPeerConnection();&#xD;&#xD;    // Configure remote audio playback&#xD;    this.pc.ontrack = (e) =&gt; {&#xD;      this.audioEl.srcObject = e.streams[0];&#xD;    };&#xD;&#xD;    // Get local audio track&#xD;    this.ms = await navigator.mediaDevices.getUserMedia({&#xD;      audio: true,&#xD;    });&#xD;    this.pc.addTrack(this.ms.getTracks()[0]);&#xD;&#xD;    // Set up data channel&#xD;    this.dc = this.pc.createDataChannel("oai-events");&#xD;    this.dc.addEventListener("message", (e) =&gt; {&#xD;      console.log("Received event:", e.data);&#xD;    });&#xD;&#xD;    // Start the session&#xD;    const offer = await this.pc.createOffer();&#xD;    await this.pc.setLocalDescription(offer);&#xD;&#xD;    const sdpResponse = await fetch(`${this.baseUrl}?model=${this.model}`, {&#xD;      method: "POST",&#xD;      body: offer.sdp,&#xD;      headers: {&#xD;        Authorization: `Bearer ${this.token}`,&#xD;        "Content-Type": "application/sdp",&#xD;      },&#xD;    });&#xD;&#xD;    const answer = {&#xD;      type: "answer",&#xD;      sdp: await sdpResponse.text(),&#xD;    };&#xD;    await this.pc.setRemoteDescription(answer);&#xD;    console.log("Session started");&#xD;  }&#xD;&#xD;  async pauseSession() {&#xD;    if (!this.ms) {&#xD;      console.log("No active session to pause.");&#xD;      return;&#xD;    }&#xD;&#xD;    this.ms.getTracks().forEach((track) =&gt; track.stop());&#xD;    this.ms = null;&#xD;&#xD;    if (this.pc) {&#xD;      this.pc.close();&#xD;      this.pc = null;&#xD;    }&#xD;&#xD;    console.log("Session paused. You can restart the session by calling startSession().");&#xD;  }&#xD;&#xD;  endSession() {&#xD;    if (this.pc) {&#xD;      this.pc.close();&#xD;      this.pc = null;&#xD;    }&#xD;    if (this.ms) {&#xD;      this.ms.getTracks().forEach((track) =&gt; track.stop());&#xD;      this.ms = null;&#xD;    }&#xD;&#xD;    console.log("Session ended");&#xD;  }&#xD;}&#xD;window.ChatSession = ChatSession;&#xD;// Example usage:&#xD;// const session = new ChatSession(&apos;your_token_here&apos;);&#xD;// session.startSession();&#xD;// session.pauseSession();&#xD;// session.endSession();</l><comment w="160.66666666666666" collapsed="false">让 chatgpt 重写这段代码为类, 包含3个方法, 启动对话, 暂停, 结束对话 </comment></block><list></list></block></script></block-definition><block-definition s="开始实时对话" type="command" category="operators"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list></list><l>session.startSession();</l></block><list></list></block></script></block-definition><block-definition s="暂停实时对话" type="command" category="operators"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list></list><l>session.pauseSession();</l></block><list></list></block></script></block-definition><block-definition s="结束实时对话" type="command" category="operators"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list></list><l>session.endSession();</l></block><list></list></block></script></block-definition></blocks><primitives></primitives><stage name="舞台" width="480" height="360" costume="0" color="255,255,255,1" tempo="60" threadsafe="false" penlog="false" volume="100" pan="0" lines="round" ternary="false" hyperops="true" codify="false" inheritance="true" sublistIDs="false" id="59"><pentrails>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAeAAAAFoCAYAAACPNyggAAAAAXNSR0IArs4c6QAADoVJREFUeF7t1cEJAAAIxDDdf2m3sJ+4wEEQuuMIECBAgACBd4F9XzRIgAABAgQIjAB7AgIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECAiwHyBAgAABAoGAAAfoJgkQIECAgAD7AQIECBAgEAgIcIBukgABAgQICLAfIECAAAECgYAAB+gmCRAgQICAAPsBAgQIECAQCAhwgG6SAAECBAgIsB8gQIAAAQKBgAAH6CYJECBAgIAA+wECBAgQIBAICHCAbpIAAQIECByxcQFpoRMBzwAAAABJRU5ErkJggg==</pentrails><costumes><list struct="atomic" id="60"></list></costumes><sounds><list struct="atomic" id="61"></list></sounds><variables></variables><blocks></blocks><scripts></scripts><sprites select="1"><sprite name="角色" idx="1" x="0" y="8.526512829121202e-14" heading="90" scale="1" volume="100" pan="0" rotation="1" draggable="true" costume="0" color="80,80,80,1" pen="tip" id="66"><costumes><list struct="atomic" id="67"></list></costumes><sounds><list struct="atomic" id="68"></list></sounds><blocks></blocks><variables></variables><scripts><script x="93" y="350.30555555555657"><custom-block s="暂停实时对话"></custom-block></script><script x="87.66666666666667" y="299.97222222222325"><custom-block s="开始实时对话"></custom-block></script><script x="64.66666666666667" y="165.33333333333303"><block s="receiveGo"></block><block s="doSetVar"><l>token</l><l></l><comment w="90" collapsed="false">填写你的 api key, 从这里申请: https://platform.openai.com/api-keys</comment></block><custom-block s="openai Realtime(WebRTC) API for speech %br token %s"><block var="token"/></custom-block></script><comment x="49.44444444444446" y="6.666666666666667" w="185.33333333333337" collapsed="false">OpenAI realtime API&#xD;https://platform.openai.com/docs/guides/realtime-webrtc&#xD;&#xD;帮助编写snap 客户端 https://chatgpt.com/share/6763e95b-aa40-800f-8366-bb3b78c43deb</comment></scripts></sprite><watcher var="token" style="normal" x="21.81818181818153" y="21.81818181818182" color="243,118,29" hidden="true"/></sprites></stage><variables><variable name="token"><l></l></variable></variables></scene></scenes></project>