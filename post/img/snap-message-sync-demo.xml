<sprites app="Snap! 9.0, https://snap.berkeley.edu" version="2"><blocks><block-definition s="_handle_incoming_message %&apos;message&apos;" type="command" category="control"><header></header><code></code><translations></translations><inputs><input type="%s"></input></inputs><script><block s="doDeclareVariables"><list><l>message_id</l><l>result</l><l>target_message</l></list></block><block s="doSetVar"><l>message_id</l><block s="reportListItem"><l>1</l><block var="message"/></block></block><block s="doSetVar"><l>result</l><block s="reportListItem"><l>2</l><block var="message"/></block></block><block s="doWarp"><script><block s="doSetVar"><l>waitForResponse</l><block s="reportKeep"><block s="reifyPredicate"><autolambda><block s="reportVariadicEquals"><list><block s="reportListItem"><l>2</l><l/></block><l>wait</l></list></block></autolambda><list></list></block><block var="waitForResponse"/></block></block><block s="doSetVar"><l>target_message</l><block s="reportFindFirst"><block s="reifyPredicate"><autolambda><block s="reportVariadicAnd"><list><block s="reportVariadicEquals"><list><block s="reportListItem"><l>2</l><block var="value"/></block><l>wait</l></list></block><block s="reportVariadicEquals"><list><block s="reportListItem"><l>1</l><block var="value"/></block><block var="message_id"/></list></block></list></block></autolambda><list><l>value</l></list></block><block var="waitForResponse"/></block></block><block s="doIf"><block var="target_message"/><script><block s="doReplaceInList"><l>2</l><block var="target_message"/><l>done</l></block><block s="doReplaceInList"><l>3</l><block var="target_message"/><block var="result"/></block></script><list></list></block></script></block></script></block-definition><block-definition s="_send_and_wait %&apos;message&apos;" type="reporter" category="control"><header></header><code></code><translations></translations><inputs><input type="%s"></input></inputs><script><block s="doDeclareVariables"><list><l>wait</l><l>message_id</l></list></block><block s="doSetVar"><l>message_id</l><block s="reportRandom"><l>1</l><l>100000000</l></block></block><block s="doSetVar"><l>wait</l><block s="reportNewList"><list><block var="message_id"/><l>wait</l><l>result</l></list></block></block><block s="doAddToList"><block var="wait"/><block var="waitForResponse"/></block><block s="doAddToList"><block s="reportNewList"><list><l>message_id</l><block var="message_id"/></list></block><block var="message"/><comment w="90" collapsed="false">then send the message via http/mqtt...</comment></block><block s="doWaitUntil"><block s="reportVariadicEquals"><list><block s="reportListItem"><l>2</l><block var="wait"/></block><l>done</l></list></block></block><block s="doReport"><block s="reportListItem"><l>3</l><block var="wait"/></block></block></script></block-definition></blocks><sprite name="Sync" idx="2" x="-30.81262729124228" y="-165.08757637474542" heading="90" scale="1" volume="100" pan="0" rotation="1" draggable="true" costume="0" color="0,73.94999999999999,20.706000000000017,1" pen="tip" id="2"><costumes><list struct="atomic" id="3"></list></costumes><sounds><list struct="atomic" id="4"></list></sounds><blocks></blocks><variables></variables><scripts><script x="95" y="160.83333333333354"><custom-block s="_handle_incoming_message %s"><block var="data"/></custom-block></script><script x="109.16666666666667" y="228.66666666666674"><custom-block s="_send_and_wait %s"><l></l></custom-block></script></scripts></sprite></sprites>