<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>MicroBlocks Client for Snap! - 夜行人</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="种瓜" /><meta name="description" content="中文版本 Preface Like many of us, you are a Smalltalker at heart! &amp;ndash;John Maloney Thanks to MicroBlocks and Snap!, we are not homeless &amp;ndash;wenjie After making the CoCube library in Snap!, I realized that most of the work in this library is general and can be used for any MicroBlocks device! By extracting the general parts of the CoCube library, the MicroBlocks Client library was obtained. Much" /><meta name="keywords" content="education, programming, Technology" />






<meta name="generator" content="Hugo 0.96.0 with theme even" />


<link rel="canonical" href="http://wwj718.github.io/post/programming/snap-microblocks-client-en/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.69e0bbe2419d9b0efbdcc1d3b4338bba03a6f6789ae2832bc1af58e5b2757470.css" rel="stylesheet">
<link rel="stylesheet" href="/post/img/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="MicroBlocks Client for Snap!" />
<meta property="og:description" content="中文版本 Preface Like many of us, you are a Smalltalker at heart! &ndash;John Maloney Thanks to MicroBlocks and Snap!, we are not homeless &ndash;wenjie After making the CoCube library in Snap!, I realized that most of the work in this library is general and can be used for any MicroBlocks device! By extracting the general parts of the CoCube library, the MicroBlocks Client library was obtained. Much" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://wwj718.github.io/post/programming/snap-microblocks-client-en/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-07-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-07-10T00:00:00+00:00" />

<meta itemprop="name" content="MicroBlocks Client for Snap!">
<meta itemprop="description" content="中文版本 Preface Like many of us, you are a Smalltalker at heart! &ndash;John Maloney Thanks to MicroBlocks and Snap!, we are not homeless &ndash;wenjie After making the CoCube library in Snap!, I realized that most of the work in this library is general and can be used for any MicroBlocks device! By extracting the general parts of the CoCube library, the MicroBlocks Client library was obtained. Much"><meta itemprop="datePublished" content="2024-07-10T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-07-10T00:00:00+00:00" />
<meta itemprop="wordCount" content="1442">
<meta itemprop="keywords" content="Snap,MicroBlocks," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MicroBlocks Client for Snap!"/>
<meta name="twitter:description" content="中文版本 Preface Like many of us, you are a Smalltalker at heart! &ndash;John Maloney Thanks to MicroBlocks and Snap!, we are not homeless &ndash;wenjie After making the CoCube library in Snap!, I realized that most of the work in this library is general and can be used for any MicroBlocks device! By extracting the general parts of the CoCube library, the MicroBlocks Client library was obtained. Much"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">夜行人</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/post/%E9%9A%8F%E7%AC%94/aboutme/">
        <li class="mobile-menu-item">About-Me</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">夜行人</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/%E9%9A%8F%E7%AC%94/aboutme/">About-Me</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">MicroBlocks Client for Snap!</h1>

      <div class="post-meta">
        <span class="post-time"> 2024-07-10 </span>
        <div class="post-category">
            <a href="/categories/snap/"> Snap </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#preface">Preface</a></li>
    <li><a href="#motivation">Motivation</a></li>
    <li><a href="#idea">Idea</a></li>
    <li><a href="#implement">Implement</a>
      <ul>
        <li><a href="#on-microblocks-side">On MicroBlocks side</a></li>
        <li><a href="#on-snap-side">On Snap! side</a></li>
      </ul>
    </li>
    <li><a href="#how-to-use-microblocks-client-library">How to use MicroBlocks Client library?</a></li>
    <li><a href="#faq">FAQ</a>
      <ul>
        <li><a href="#how-to-add-more-microblocks-client-library">How to add more MicroBlocks Client library?</a>
          <ul>
            <li><a href="#usage-scenarios">Usage scenarios</a></li>
          </ul>
        </li>
        <li><a href="#how-to-debug-snap-and-microblocks-code-simultaneously">How to debug Snap! and MicroBlocks code simultaneously?</a></li>
        <li><a href="#how-to-save-and-load-microblocks-projects-in-the-microblocks-window-of-snap">How to save and load MicroBlocks projects in the MicroBlocks window of Snap!?</a>
          <ul>
            <li><a href="#save-project">Save project</a></li>
            <li><a href="#open-project">open project</a></li>
          </ul>
        </li>
        <li><a href="#how-to-find-the-vm-primitives-provided-by-microblocks">How to find the vm primitives provided by MicroBlocks?</a></li>
        <li><a href="#the-push-style-version">the push style version</a></li>
        <li><a href="#is-it-possible-to-create-a-similar-python-client-library">Is it possible to create a similar Python client library?</a>
          <ul>
            <li><a href="#connect-multiple-devices">Connect multiple devices</a></li>
            <li><a href="#parallel-control">Parallel Control</a></li>
          </ul>
        </li>
        <li><a href="#how-to-make-a-python-library-for-a-custom-microblocks-device">How to make a Python library for a custom MicroBlocks device</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="/post/%E7%BC%96%E7%A8%8B/snap-microblocks-client/"><strong>中文版本</strong></a></p>
<h1 id="preface">Preface</h1>
<blockquote>
<p>Like many of us, you are a Smalltalker at heart! &ndash;<a href="https://discord.com/channels/1000653853491998760/1242835179534553119/1266711087319875655">John Maloney</a></p>
</blockquote>
<blockquote>
<p>Thanks to MicroBlocks and Snap!, we are not homeless &ndash;wenjie</p>
</blockquote>
<p>After making <a href="/post/programming/snap-cocube-en/">the CoCube library in Snap!</a>, I realized that most of the work in this library is general and <strong>can be used for any MicroBlocks device</strong>!</p>
<p>By extracting the general parts of the CoCube library, the MicroBlocks Client library was obtained.</p>
<p>Much of the content of this article overlaps with <a href="/post/programming/snap-cocube-en/">the CoCube library in Snap!</a>, and the MicroBlocks Client library is essentially a general version of the CoCube library.</p>
<h1 id="motivation">Motivation</h1>
<p>Using Snap! to drive MicroBlocks devices usually has the following two motivations:</p>
<ul>
<li>Use the existing Snap! AI library for MicroBlocks devices</li>
<li>Making advanced libraries (especially for robotics-related projects) in a host computer with stronger computing power</li>
</ul>
<h1 id="idea">Idea</h1>
<blockquote>
<p>The key in making great and growable systems is much more to design how its modules communicate rather than what their internal properties and behaviors should be. &ndash; Alan Kay</p>
</blockquote>
<p>Because Snap! and MicroBlocks are both products of the <strong>personal computing</strong> spirit, both possess exceptional dynamism, I am confident that the goal(programming MicroBlocks devices in Snap!) can be achieved through <strong>message passing</strong>. In fact, MicroBlocks IDE collaborates with VM through message passing mechanism.</p>
<p>I like to use message passing to design the interoperability mechanism between systems, as this can minimize the coupling between systems.</p>
<p>There is already a library in Snap! for directly passing messages between Snap! and MicroBlocks</p>
<p><img src="/post/img/CoCube-03.png" alt=""></p>
<p>This library provides the basic functionality for message passing. I intend to use this library to create the MicroBlocks Client library, wanting to achieve:</p>
<ol>
<li>Users can get the status of MicroBlocks devices in Snap! (by reporter blocks)</li>
<li>Users can send commands (by command blocks) to MicroBlocks devices in Snap!</li>
<li>Users only need to program in Snap! without switching back and forth between Snap! and MicroBlocks.</li>
<li>As good extensibility as possible</li>
</ol>
<p>Regarding point 1: <strong>get the status of another system</strong>. There are usually two ways to do it:</p>
<ul>
<li>push style: A system continuously broadcasts messages carrying status data to another system
<ul>
<li><a href="https://github.com/firmata/protocol">Firmata</a> is this style</li>
<li>Most of Scratch3.0&rsquo;s hardware libraries are of this style, such as the micro:bit library, refer to <a href="https://wwj718.github.io/post/%E5%B0%91%E5%84%BF%E7%BC%96%E7%A8%8B/scratch3-microbit-analysis/">the analysis of the communication between scratch3.0 and micro:bit</a>.</li>
</ul>
</li>
<li>pull style: Query the status, usually using request-response style communication.
<ul>
<li>RPC/HTTP is this style</li>
<li><a href="https://wwj718.github.io/post/%E7%BC%96%E7%A8%8B/introducing-dynatalk/">Dynatalk</a> is this style</li>
</ul>
</li>
</ul>
<p>The MicroBlocks messaging(BLE) library provides a PubSub style message passing mechanism. I intend to build dynatalk-over-ble based on it, and then implement a pull style MicroBlocks Client library based on dynatalk-over-ble (similar to <a href="https://wwj718.github.io/post/programming/snap-spline-en/#what-is-the-use-of-dynatalk-over-postmessage-blocks">dynatalk-over-postmessage</a>)</p>
<p>In our use case, we only need to implement a unidirectional C/S architecture (Snap! as the client, MicroBlocks as the server). Therefore, the complexity of dynatalk-over-ble is only half that of regular <a href="https://wwj718.github.io/post/%E7%BC%96%E7%A8%8B/introducing-dynatalk/">dynatalk</a>. The good news is that the half handled by the computationally weaker MicroBlocks is extremely simple.</p>
<h1 id="implement">Implement</h1>
<h2 id="on-microblocks-side">On MicroBlocks side</h2>
<p>As mentioned earlier, we want:</p>
<blockquote>
<p>Users only need to program in Snap! without switching back and forth between Snap! and MicroBlocks.</p>
</blockquote>
<p>Therefore, I hope the code on the MicroBlocks side is completely <strong>universal</strong>. Users only need to save this universal program to the device and then no longer need to open the MicroBlocks platform, allowing them to program the device entirely in Snap!</p>
<p>To achieve this, we save <a href="https://microblocksfun.cn/run/microblocks.html#project=https://wwj718.github.io/post/img/MicroBlocks-server-dynatalk.ubp">this universal program</a> to the device:</p>
<p><img src="/post/img/snap-MicroBlocks-Client-04-dynatalk.png" alt=""></p>
<p>This program is responsible for the following tasks:</p>
<ul>
<li>Interpret the received message and &ldquo;ground&rdquo; the semantics of the message to the specific functions of the hardware device. The &ldquo;grounding&rdquo; work is implemented using the <code>call</code> block, which is similar to <code>eval</code> in other programming languages and can dynamically run custom blocks and VM primitives.
<ul>
<li><code>handle_message</code> block is used to handle non-blocking messages</li>
<li><code>handle_blocking_message</code> block is used to handle blocking messages</li>
</ul>
</li>
</ul>
<p>You can think of this program as a server running on hardware, and Snap! as its client. We used the C/S architecture.</p>
<h2 id="on-snap-side">On Snap! side</h2>
<p>As mentioned earlier, we want:</p>
<blockquote>
<ol>
<li>Users can get the status of MicroBlocks devices in Snap! (by reporter blocks)</li>
<li>Users can send commands (by command blocks) to MicroBlocks devices in Snap!</li>
</ol>
</blockquote>
<p>We show how they are implemented separately.</p>
<p>For point 1, get the status of MicroBlocks devices in Snap! (by reporter blocks):</p>
<p><img src="/post/img/snap-MicroBlocks-Client-06-dynatalk.png" alt=""></p>
<p>For point 2, send commands (by command blocks) to MicroBlocks devices in Snap!</p>
<p><img src="/post/img/snap-MicroBlocks-Client-05-dynatalk.png" alt=""></p>
<p>The message is in pure string form, carrying the method name (custom block name or vm primitives) and parameters, separated by <code>,</code>. Here is an example: <code>call, &lt;msg-id&gt;, [display:mbPlot], 3, 3</code></p>
<h1 id="how-to-use-microblocks-client-library">How to use MicroBlocks Client library?</h1>
<p>To use the MicroBlocks Client library, simply open the <a href="https://snap.codelab.club/snap.html">Snap!</a>.</p>
<p>Load the MicroBlocks Client library,</p>
<p><img src="/post/img/snap-MicroBlocks-Client-07.png" alt=""></p>
<p>Click <code>open MicroBlocks project</code> block to open the MicroBlocks window. After connecting the device and uploading the program, you can disconnect the device and close the MicroBlocks window.</p>
<p><img src="/post/img/snap-MicroBlocks-Client-08-dynatalk.png" alt=""></p>
<p>Then start programming in Snap!.</p>
<h1 id="faq">FAQ</h1>
<h2 id="how-to-add-more-microblocks-client-library">How to add more MicroBlocks Client library?</h2>
<p>Download <code>https://snap.codelab.club/libraries/MicroBlocks-Client.xml</code>. (Open in browser, save as local file)</p>
<p>then:</p>
<ul>
<li>Renamed <code>MicroBlocks-Client.xml</code> to <code>MicroBlocks-Client2.xml</code></li>
<li>Edit <code>MicroBlocks-Client2.xml</code>:
<ul>
<li>Replace all <code>🐰</code> with <code>🐰2</code> (VSCode has a batch replace function)</li>
<li>Replace all <code>_ble_</code> with <code>_ble2_</code></li>
</ul>
</li>
<li>Drag <code>MicroBlocks-Client2.xml</code> into Snap!. (this is an example: <code>https://wwj718.github.io/post/img/MicroBlocks-Client2.xml</code>)</li>
</ul>
<p>By analogy, you can add any number of MicroBlocks Clients!</p>
<h3 id="usage-scenarios">Usage scenarios</h3>
<p>When there are multiple MicroBlocks devices, Snap! is perfect as a <strong>dashboard</strong> to control them all.</p>
<p><img src="/post/img/snap-MicroBlocks-Client-10.png" alt=""></p>
<h2 id="how-to-debug-snap-and-microblocks-code-simultaneously">How to debug Snap! and MicroBlocks code simultaneously?</h2>
<p>Yes, you can debug both software and hardware side code simultaneously! Everything is liveness!</p>
<p>You can connect the same device simultaneously in Snap! and MicroBlocks , then observe the flow of messages between them:</p>
<p><img src="/post/img/snap-MicroBlocks-Client-12-dynatalk.png" alt=""></p>
<h2 id="how-to-save-and-load-microblocks-projects-in-the-microblocks-window-of-snap">How to save and load MicroBlocks projects in the MicroBlocks window of Snap!?</h2>
<h3 id="save-project">Save project</h3>
<p>Due to iframe limitations, you cannot use the <code>Save</code> button in the menu to save local files</p>
<p>Alternative solution: click <code>Copy project url to clipboard</code> , then paste it into the browser&rsquo;s address bar, and then save it.</p>
<h3 id="open-project">open project</h3>
<p>Due to iframe limitations, you cannot use the <code>Open</code> button in the menu to open local files</p>
<p>Alternative solution: drag the local files directly into the MicroBlocks window.</p>
<h2 id="how-to-find-the-vm-primitives-provided-by-microblocks">How to find the vm primitives provided by MicroBlocks?</h2>
<p>You can find these primitives in the ubl library file, in the form of . <code>[a:b]</code> , such as <code>[display:mbPlot]</code></p>
<p><img src="/post/img/CoCube-11.png" alt=""></p>
<p>Peter shared some examples on <a href="https://discord.com/channels/1000653853491998760/1083593745531936778/1259460898607857734">Discord</a>:</p>
<p><img src="/post/img/primitives-demo.png" alt=""></p>
<h2 id="the-push-style-version">the push style version</h2>
<p>On MicroBlocks side:</p>
<p><img src="/post/img/snap-MicroBlocks-Client-04.png" alt=""></p>
<p>This program is responsible for the following tasks:</p>
<ol>
<li>Continuously push out the status of the device (<code>when started</code> block), it can be extended. The current update rate is 20/second (customizable).</li>
<li>Interpret the received message ( <code>handle_message</code> block), grounding the semantics of the message to the specific functions of the hardware device. The &ldquo;grounding&rdquo; work is achieved using the <code>call</code> block, which is similar to <code>eval</code> in other programming languages, allowing for the dynamic execution of custom blocks and VM primitives.</li>
</ol>
<p><a href="https://snap.codelab.club/snap.html#open:https://wwj718.github.io/post/img/MicroBlocks-Client-demo.xml">Project link (Click to Run)</a></p>
<p>It is worth noting that the speed of push is much faster than pull. If necessary, they can be combined.</p>
<h2 id="is-it-possible-to-create-a-similar-python-client-library">Is it possible to create a similar Python client library?</h2>
<p>The design of this article can be easily migrated to Python. By using the <a href="https://github.com/wwj718/microblocks_messaging_library">microblocks_messaging_library</a> and <a href="https://github.com/wwj718/dynatalk-py">dynatalk-py</a> libraries, it is easy to achieve the same functionality as the MicroBlocks Client library of Snap!.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="c1"># pip install -U microblocks</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">microblocks</span> <span class="kn">import</span> <span class="n">MicroblocksClient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">MicroblocksClient</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">found_devices</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># timeout=5 in windows</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;found devices:&#34;</span><span class="p">,</span> <span class="n">found_devices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&#34;MicroBlocks AZB&#34;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span><span class="o">.</span><span class="n">display_character</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">tiltX</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">tiltX</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">tiltX</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Remember to first load <a href="https://microblocksfun.cn/run/microblocks.html#project=https://wwj718.github.io/post/img/MicroBlocks-server-dynatalk.ubp">this program</a> into the device (same as Snap!)</p>
<p>For more API examples: <a href="https://github.com/wwj718/microblocks_messaging_library/tree/main/notebooks">notebooks</a></p>
<p><a href="https://github.com/wwj718/microblocks_messaging_library">The source code</a> of the CoCube library</p>
<h3 id="connect-multiple-devices">Connect multiple devices</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">microblocks</span> <span class="kn">import</span> <span class="n">MicroblocksClient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">client</span> <span class="o">=</span> <span class="n">MicroblocksClient</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">found_devices</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;found devices:&#34;</span><span class="p">,</span> <span class="n">found_devices</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># connect all discovered devices</span>
</span></span><span class="line"><span class="cl"><span class="n">devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">MicroblocksClient</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">found_devices</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">devices</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">device</span><span class="o">.</span><span class="n">display_character</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="parallel-control">Parallel Control</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Launching parallel tasks: https://docs.python.org/3/library/concurrent.futures.html</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">client</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">client</span><span class="o">.</span><span class="n">scroll_text</span><span class="p">,</span> <span class="s2">&#34;hello&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="how-to-make-a-python-library-for-a-custom-microblocks-device">How to make a Python library for a custom MicroBlocks device</h2>
<p>The MicroblocksClient class above is generic. To make a Python library for a custom MicroBlocks device, you only need to inherit the MicroblocksClient class and add custom methods. See <a href="https://github.com/wwj718/cocube/blob/main/src/cocube/__init__.py">CoCube</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">microblocks</span> <span class="kn">import</span> <span class="n">MicroblocksClient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CoCube</span><span class="p">(</span><span class="n">MicroblocksClient</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">battery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&#34;Battery Percentage&#34;</span><span class="p">,</span> <span class="p">[]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@property</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">position_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&#34;position_X&#34;</span><span class="p">,</span> <span class="p">[]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">move_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&#34;Move Forward&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">speed</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">move_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&#34;Move Backward&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">speed</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://github.com/wwj718/cocube">The CoCube Python library</a> is created using <a href="https://hatch.pypa.io/latest/why/">Hatch</a>. I recommend using Hatch for developing and publishing Python projects.</p>
<h1 id="references">References</h1>
<ul>
<li><a href="https://wwj718.github.io/post/%E7%BC%96%E7%A8%8B/snap-cocube/#%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E6%9B%B4%E5%A4%9A-cocube">Snap! 中的 CoCube 库</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">种瓜</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2024-07-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/snap/">Snap</a>
          <a href="/tags/microblocks/">MicroBlocks</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/%E7%BC%96%E7%A8%8B/godot-note/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Godot 学习笔记</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/%E7%BC%96%E7%A8%8B/snap-microblocks-client/">
            <span class="next-text nav-default">Snap! 中的 MicroBlocks Client 库</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:wuwenjie718@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="mailto:wuwenjie718@gmail.com" class="iconfont icon-out-me" title="out-me"></a>
      <a href="https://github.com/wwj718" class="iconfont icon-github" title="github"></a>
  <a href="http://wwj718.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  
  <span><a target="_blank" href="https://cn.bing.com/search?q=site%3Awwj718.github.io%20%20codelab-adapter">搜索本站</a></span>
  <span class="division">|</span>
  <span><a target="_blank" href="/index.xml">RSS订阅</a></span>
  <span class="division">|</span>
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2013 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>种瓜</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="/post/img/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="/post/img/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="/post/img/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?18db4b662c04fbd6cc2851d246c51b3f";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
